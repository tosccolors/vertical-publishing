<?xml version="1.0" encoding="utf-8"?>
<odoo>
<data>

    <record id="view_sao_order_line_tree" model="ir.ui.view">
        <field name="name">sale.sao.order.line.tree</field>
        <field name="model">sale.order.line</field>
        <field name="arch" type="xml">
            <tree string="Sales Order Lines"  decoration-info="invoice_status=='to invoice'"
                  default_order='issue_date'>
<!--                <control> FIXME need this? -->
<!--                    <create name="add_product_control" string="Add a product"/>-->
<!--                    <create name="add_section_control" string="Add a section" context="{'default_display_type': 'line_section'}"/>-->
<!--                    <create name="add_note_control" string="Add a note" context="{'default_display_type': 'line_note'}"/>-->
<!--                </control>-->

                <field name="sequence" widget="handle"/>
                <field name="product_uom_category_id" invisible="1"/>
                <field name="id" optional="hide"/>
                <field name="title_ids" invisible="1"/>
                <field name="adv_issue_ids" widget="many2many_tags"/>
                <field name="issue_date" />
                <field name="from_date" optional="hide"/>
                <field name="to_date" optional="hide"/>
                <field name="deadline"/>
<!--                <field name="ad_class" groups="base.group_no_one" optional="hide"/>-->
                <field name="product_id"/>
                <field name="name" groups="base.group_no_one" optional="hide"/>
                <field name="ad_number" optional="show"/>
                <field name="page_reference" optional="show"/>
                <field name="analytic_tag_ids" groups="analytic.group_analytic_accounting"
                       string="Page Category" widget="many2many_tags" optional="hide"/>
                <field name="price_unit" optional="hide"/>
                <field name="actual_unit_price" widget="monetary"/>
                <field name="product_uom_qty"/>
                <field name="product_uom" invisible="1" groups="!uom.group_uom"/>
                <field name="comb_list_price" widget="monetary" optional="hide"/>
                <field name="computed_discount" />
                <field name="subtotal_before_agency_disc" widget="monetary" optional="hide"/>
<!--                <field name="discount_dummy" optional="hide"/>-->
                <field name="tax_id" widget="many2many_tags"
                        groups="account.group_account_invoice, sale_advertising_order.group_ads_traffic_user"/>
                <field name="discount" groups="product.group_discount_per_so_line" invisible="1"/>
                <field name="price_subtotal" widget="monetary" groups="account.group_show_line_subtotals_tax_excluded"/>
                <field name="price_total" widget="monetary" groups="account.group_show_line_subtotals_tax_included"/>
                <field name="state" invisible="1"/>
                <field name="invoice_status" optional="hide"/>
                <field name="currency_id" invisible="1"/>
                <field name="company_id" invisible="1"/>
                <button name="cancel_line" icon="fa-cog" string="Cancel"  type="object"
                        attrs="{'invisible': [('invoice_status','!=', 'to invoice')]}"
                        confirm="Are you sure you want to cancel this line?"
                        groups="sale_advertising_order.group_ads_traffic_user"/>
            </tree>
        </field>
    </record>


    <record id="view_sao_order_line_form" model="ir.ui.view">
        <field name="name">sale.sao.order.line.form</field>
        <field name="model">sale.order.line</field>
        <field name="arch" type="xml">
            <form string="Sales Order Lines">
                <group>
                    <group>
                        <field name="product_uom_category_id" invisible="1"/>
                        <field name="medium" required="True"
                               domain="[('parent_id','=', %(sale_advertising_order.advertising_category)d)]"
                               options="{'no_open': True,'no_create': True, 'no_create_edit': True}"/>
                        <field name="ad_class" required="True"
                               options="{'no_open': True,'no_create': True, 'no_create_edit': True}"/>
                        <field name="title" string="Title" invisible="1"/>
                        <field name="title_ids" string="Title(s)"
                               widget="many2many_tags"
                               domain="[('parent_id','=', False), ('medium','child_of', medium)]"
                               options="{'no_open': True,'no_create': True, 'no_create_edit': True}"
                               context="{'active_test': False, 'search_view_ref':'sale_advertising_order.view_advertising_issue_filter',
                                         'tree_view_ref':'sale_advertising_order.advertising_issue_titles_tree' }">
                        </field>
                        <field name="from_date"
                               attrs="{'invisible':[('date_type','!=','validity')], 'required':[('date_type','=','validity')]}"/>
                        <field name="to_date"
                               attrs="{'invisible':[('date_type','!=','validity')], 'required':[('date_type','=','validity')]}"/>
                        <field name="deadline_offset" invisible="1" />
                        <field name="deadline_passed" invisible="1" />
                        <field name="deadline" invisible="0" />
                        <field name="adv_issue_ids" string="Advertising Issue(s)"
                               widget="many2many_tags"
                               attrs="{'readonly': [('issue_product_ids','!=', [])]}"
                               domain="[('parent_id','in', title_ids),
                                        '|','|',('deadline','&gt;=', deadline_offset),('deadline','=', False),
                                                ('issue_date','&lt;=', datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S'))]"
                               options="{'no_open': True,'no_create': True, 'no_create_edit': True}"
                               context="{'active_test': False, 'search_view_ref':'sale_advertising_order.view_advertising_issue_filter',
                                         'tree_view_ref':'sale_advertising_order.advertising_issue_ids_tree' }">

                        </field>

                        <field name="issue_date" readonly="1" force_save="1"
                               attrs="{'invisible': [('multi_line', '=', True)]}"/>
                        <field name="domain4prod_ids" invisible="1"/>
                        <field name="product_template_id" domain="[('id','in', domain4prod_ids)]"
                               context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'uom':product_uom, 'company_id': parent.company_id}"
                               attrs="{'readonly': ['|', ('qty_invoiced', '&gt;', 0), ('deadline_passed','=', True)]}"
                               options="{'no_open': True,'no_create': True, 'no_create_edit': True}" required="1"/>
                        <field name="product_id" invisible="1" groups="base.group_no_one"
                               context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'uom':product_uom, 'company_id': parent.company_id}"
                               attrs="{'readonly': [('qty_invoiced', '&gt;', 0)]}"
                               domain="['|','&amp;',('categ_id','=', ad_class),('product_template_attribute_value_ids','=', False),('product_tmpl_id','=', product_template_id)]"
                               options="{'no_open': True,'no_create': True, 'no_create_edit': True}"/>
                        <field name="invoice_status" invisible="1"/>
                        <field name="qty_to_invoice" invisible="1"/>
                        <field name="nett_nett" />
                        <field name="multi_line" invisible="1"/>
                        <field name="multi_line_number" readonly="True" groups="base.group_no_one"/>
                        <field name="adv_issue" invisible="1"/>

                    </group>
                    <group name="price_section">
                        <label for="customer_lead" invisible="1" groups="base.group_no_one"/>
                        <div groups="base.group_no_one" invisible="1">
                            <field name="customer_lead" class="oe_inline" groups="base.group_no_one"/> days
                        </div>
                        <label for="product_uom_qty" string="Ordered Quantity"/>
                        <div>
                            <field name="product_uom_qty" class="oe_inline"
                                   context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id,
                                                'uom':product_uom, 'uom_qty_change':True, 'company_id': parent.company_id}"
                                   attrs="{'readonly': [('deadline_passed','=', True)]}"/>
                            <field name="product_uom" invisible="1" groups="!uom.group_uom"/>
                            <field name="product_uom" groups="uom.group_uom" class="oe_inline oe_no_button"
                                   readonly="True"/>
                        </div>
                        <label for="qty_delivered" string="Delivered Quantity" invisible="1"/>
                        <div invisible="1">
                            <field name="qty_delivered"/>
                        </div>
                        <label for="qty_invoiced" string="Invoiced Quantity" invisible="1"/>
                        <div invisible="1">
                            <field name="qty_invoiced" invisible="context.get('hide_sale')"/>
                        </div>
                        <field name="tax_id" widget="many2many_tags"
                            domain="[('type_tax_use','=','sale'),('company_id','=',parent.company_id)]"
                            groups="sale_advertising_order.group_ads_traffic_user"
                            attrs="{'readonly': [('qty_invoiced', '&gt;', 0)]}"/>
                        <field name="price_edit" invisible="1"/>
                        <field name="price_unit" readonly="0" attrs="{'invisible': ['|',('multi_line','=', True),('price_edit','!=', True)]}"
                                widget="monetary" options="{'currency_field': 'currency_id'}" />
                        <field name="price_unit_dummy" readonly="1" attrs="{'invisible': ['|',('multi_line','=', True),('price_edit','=', True)]}"
                                widget="monetary" options="{'currency_field': 'currency_id'}" />
                        <field name="comb_list_price" readonly="True" attrs="{'invisible': [('multi_line','=', False)]}"
                                widget="monetary" options="{'currency_field': 'currency_id'}" />
                        <field name="actual_unit_price" attrs="{'invisible': [('multi_line','=', True)]}" widget="monetary"
                                options="{'currency_field': 'currency_id'}" />
                        <field name="computed_discount" invisible="1" groups="!product.group_discount_per_so_line"/>
                        <label for="computed_discount" groups="product.group_discount_per_so_line"/>
                            <div name="computed_discount" groups="product.group_discount_per_so_line">
                                <field name="computed_discount" class="oe_inline"/> %%
                            </div>
                        <field name="discount_reason_id" attrs="{'invisible': [('computed_discount','=', 0.0)],'required': [('computed_discount','!=', 0.0)]}"/>
                        <field name="subtotal_before_agency_disc" readonly="False"/>
                        <label for="discount" string="Agency Commission" groups="product.group_discount_per_so_line"/>
                            <div name="discount" string="Agency Discount (%)" groups="product.group_discount_per_so_line">
                                <field name="discount" invisible="1"/>
<!--                                <field name="discount_dummy" class="oe_inline"/> %%-->
                            </div>
                        <field name="price_subtotal" readonly="True" widget="monetary"
                                options="{'currency_field': 'currency_id'}" />
                        <field name="date_type" invisible="True"/>
                        <field name="currency_id" invisible="1"/>
                    </group>
                </group>

                <notebook>
                   <page string="Remarks">
                       <group>
                           <group>
                               <separator string="Description" colspan="2"/>
                               <field name="name" colspan="2" nolabel="1"/>
                               <separator string="Material Remarks" colspan="2"/>
                               <field name="layout_remark" colspan="2" nolabel="1"/>
                               <separator string="Migration Remarks" colspan="2"/>
                               <field name="mig_remark" colspan="2" nolabel="1"/>
                            </group>
                           <group>
                               <field name="page_class_domain" invisible="1"/>
                               <label for="analytic_tag_ids" string="Page Category"/>
                               <div>
                                    <field name="analytic_tag_ids"
                                           string="Page Category"
                                           widget="many2many_tags"
                                           domain="page_class_domain"
                                           attrs="{'readonly': [('deadline_passed','=', True)]}"/>
                               </div>
                                <field name="ad_number" attrs="{'invisible':[('multi_line','!=', False)]}"/>
                                <field name="page_reference" attrs="{'invisible':[('multi_line','!=', False)]}"/>
                                <field name="url_to_material" attrs="{'invisible':[('multi_line','!=', False)]}"/>
                           </group>
                       </group>
                       <div groups="base.group_no_one">
                           <label for="invoice_lines"/>
                           <field name="invoice_lines"/>
                       </div>
                       <field name="state" invisible="1"/>
                   </page>
                   <page string="Proof Numbers">
                       <group>
                           <group>
                                <field name="proof_number_adv_customer" string="Proof Number Advertising Customer"
                                       domain="['|',('id', '=', parent.published_customer), ('parent_id', '=', parent.published_customer)]"
                                       context="{'default_parent_id': 'parent.partner_id', 'show_email': 1}" options="{'no_create_edit': True}" widget="many2many_tags"/>
                                <field name="proof_number_payer" />
                           </group>
                           <group>
                                <field name="proof_number_amt_adv_customer" attrs="{'invisible':[('proof_number_amt_adv_customer','=', 0)],'required':[('proof_number_adv_customer','!=', False)]}"/>
                                <field name="proof_number_payer_id" domain="[('type', '=', 'contact'),('id','child_of',parent.partner_id)]" attrs="{'required': [('proof_number_amt_payer', '>', 0)]}" context="{'default_parent_id': 'order_partner_id', 'show_address': 1}" options="{'no_create_edit': True, 'always_reload': True}"/>
                                <field name="proof_number_amt_payer" attrs="{'invisible':[('proof_number_payer_id','=', False)],'required':[('proof_number_payer_id','!=', False)]}"/>
                           </group>
                       </group>
                   </page>
                   <page string="Adv.Issues with Products and Prices" attrs="{'invisible':[('issue_product_ids','=',[])]}">
                       <field name="issue_product_ids" string="Adv.Issues with Products and Prices"
                               nolabel="1" options="{'no_create': True, 'no_create_edit': True}" readonly="0">
                            <tree string="Issues Products Prices" editable="bottom">
                                <field name="adv_issue_id" string="Issue" force_save="1" domain="[('parent_id','in', parent.title_ids)]"/>
                                <field name="product_attribute_value_id" force_save="1"  invisible="True" />
                                <field name="product_id" force_save="1"  string="Product" domain="[('product_tmpl_id','=', parent.product_template_id), ('product_template_attribute_value_ids','in', product_attribute_value_id)]"/>
                                <field name="price_edit" force_save="1"  string="Price editable" invisible="1"/>
                                <field name="price_unit" force_save="1"  string="Unit Price"
                                       attrs="{'readonly': [('price_edit','!=', True)]}"/>
                                <field name="qty" force_save="1"  string="Qty"/>
                                <field name="price" force_save="1"  string="Price"/>
                                <field name="page_reference" string="Page Pref." />
                                <field name="ad_number" string="External Ref." />
                                <field name="url_to_material" string="URL Ad Material" />
                            </tree>
                        </field>
                   </page>
                </notebook>
            </form>
        </field>
    </record>

    <record id="sale_order_view_form_sao" model="ir.ui.view">
        <field name="name">sale.order.inherit.sao</field>
        <field name="model">sale.order</field>
        <field name="mode">primary</field>
        <field name="inherit_id" ref="sale.view_order_form" />
        <field name="arch" type="xml">
            <xpath expr="//button[@id='create_invoice_percentage']" position="after">
					<button name="action_submit" string="Submit for Approval" states="draft" type="object"
                            class="oe_highlight" groups="sale_advertising_order.group_ads_sales_user"/>

					<button name="action_approve1" string="Approve Quotation"
                            states="submitted" type="object" class="oe_highlight"
							groups="sale_advertising_order.group_ads_sales_manager"/>

					<button name="action_refuse" string="Refuse"
                            type="object" states="submitted"
							groups="sale_advertising_order.group_ads_sales_manager"/>
            </xpath>
            <xpath expr="//button[@name='action_cancel']" position="after">
                    <button name="action_cancel"  id="cancel" type="object" string="Cancel"
                                  states="draft,sent"
                                  groups="sale_advertising_order.group_ads_sales_user"/>
                    <button name="action_cancel" id="cancel1" type="object" string="Cancel"
                                  states="submitted,approved1"
                                  groups="sale_advertising_order.group_ads_sales_manager"/>
                    <button name="action_cancel" id="cancel2" type="object" string="Cancel"
                             states="sale"
                             groups="sale_advertising_order.group_ads_traffic_user"/>
            </xpath>
            <xpath expr="//field[@name='tag_ids']" position="after">
                <field name="advertising" invisible="1"/>
                <field name="display_discount_to_customer"/>
                <field name="nett_nett"/>
            </xpath>

            <xpath expr="//field[@name='partner_id']" position="before">
                <field name="pub_cust_domain" invisible="1"/>
                <field name="agency_is_publish" />
                <field name="published_customer"
                       context="{'tree_view_ref': 'sale_advertising_order.view_partner_tree_nsm_crm', 'res_partner_search_mode': 'customer'}"
                       attrs="{'readonly':['|',('state','in', ['cancel','done']),('state','in', ['sale'])]}"
                       required="True" options="{'no_create':True}"/>
<!--                       domain="pub_cust_domain" FIXME-->
            </xpath>
            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="customer_contact" required="False"
                       context="{'default_parent_id': partner_id, 'show_email': 1, 'res_partner_search_mode': 'customer'}"
                       domain="[('is_company', '=', False),('parent_id', '=', partner_id),('type', '=', 'contact')]"
                       options='{"always_reload": True, "no_create_edit": True}'
                       attrs="{'readonly':[('state','in', ['cancel','done'])]}"/>
                <field name="advertising_agency"
                       domain="[('is_ad_agency','=', True),('is_customer', '=', True), ('is_company','=', True)]"
                       attrs="{'readonly':['|',('state','in', ['cancel','done']),('state','in', ['sale']),('invoice_status','not in','not invoiced')]}"
                       context="{'res_partner_search_mode': 'customer'}"/>
            </xpath>

            <xpath expr="//field[@name='team_id']" position="after">
                <field name="partner_acc_mgr"/>
            </xpath>


<!--            <xpath expr="//page[@name='order_lines']" position="attributes">-->
<!--                <attribute name="attrs">{'invisible':[('advertising', '=', True)]}</attribute>-->
<!--            </xpath>-->

            <xpath expr="//page[@name='order_lines']/field[@name='order_line']" position="replace">
                    <field
                        name="order_line"
                        mode="tree,kanban,form"
                        attrs="{'readonly': [('state', 'in', ('done','cancel'))]}"
                        context="{'tree_view_ref':'sale_advertising_order.view_sao_order_line_tree',
                            'form_view_ref':'sale_advertising_order.view_sao_order_line_form'}"
                    >
<!--                        widget="section_and_note_one2many" FIXME: need this? -->
                </field>
            </xpath>

        </field>
    </record>







        <!--
            Sale Order (SAO) - List
        -->
    <record id="view_order_advertising_tree" model="ir.ui.view">
        <field name="name">sale.order.advertising.tree</field>
        <field name="model">sale.order</field>
        <field name="priority">20</field>
        <field name="arch" type="xml">
            <tree string="Sales Orders" multi_edit="1" sample="1">
                <field name="message_needaction" invisible="1"/>
                <field name="name" string="Order Number" decoration-bf="1"/>
                <field name="date_order" widget="date" optional="show"/>
<!--                    <field name="opportunity_subject" string="Subject"/>-->
                <field name="published_customer"/>
                <field name="advertising_agency"/>
<!--                    <field name="partner_acc_mgr"/>-->
                <field name="user_id" optional="show" widget="many2one_avatar_user"/>
<!--                    <field name="operating_unit_id" groups="operating_unit.group_multi_operating_unit"/>-->
                <field name="activity_ids" widget="list_activity" optional="show"/>
                <field name="team_id" optional="hide"/>
                <field name="amount_untaxed" sum="Total Tax Excluded" widget="monetary" optional="hide"/>
                <field name="amount_tax" sum="Tax Total" widget="monetary" optional="hide"/>
                <field name="amount_total" sum="Total Tax Included" widget="monetary" decoration-bf="1" optional="show"/>
                <field name="currency_id" invisible="1"/>
                <field name="invoice_status" decoration-success="invoice_status == 'invoiced'" decoration-info="invoice_status == 'to invoice'" decoration-warning="invoice_status == 'upselling'" widget="badge" optional="show"/>
                <field name="tag_ids" optional="hide" widget="many2many_tags" options="{'color_field': 'color'}"/>
                <field name="state" invisible="1"/>
                <field name="company_id" invisible="1"/>
            </tree>
        </field>
    </record>


        <!--
            Sale Order (SAO)
        -->
<!--        <record id="view_order_form_advertising" model="ir.ui.view">-->
<!--            <field name="name">sale.order.form.advertising</field>-->
<!--            <field name="model">sale.order</field>-->
<!--			<field name="priority">20</field>-->
<!--            <field name="arch" type="xml">-->
<!--                <form string="Sales Order" class="o_sale_order">-->
<!--                <header>-->
<!--                    <button name="%(sale.action_view_sale_advance_payment_inv)d"-->
<!--                            string="Create Invoice"-->
<!--                            type="action" class="btn-primary"-->
<!--                            attrs="{'invisible': ['|', ('state', '!=', 'sale'),-->
<!--                                                  '|', ('state', '=', 'sale'),  ('invoice_status', '!=', 'to invoice'),-->
<!--                                                  '|',('invoice_status', '!=', 'to invoice'), ('state', '!=', 'sale')]}"-->
<!--                            groups="sale_advertising_order.group_ads_traffic_user"/>-->

<!--                    <button name="%(sale.action_view_sale_advance_payment_inv)d"-->
<!--                            string="Create Invoice"-->
<!--                            type="action" context="{'default_advance_payment_method': 'percentage'}"-->
<!--                            attrs="{'invisible': ['|',('invoice_status', '!=', 'no'), ('state', '!=', 'sale')]}"-->
<!--                            groups="sale_advertising_order.group_ads_traffic_user"/>-->

<!--					<button name="action_submit" string="Submit for Approval" states="draft" type="object"-->
<!--                            class="oe_highlight" groups="sale_advertising_order.group_ads_sales_user"/>-->

<!--					<button name="action_approve1" string="Approve Quotation"-->
<!--                            states="submitted" type="object" class="oe_highlight"-->
<!--							groups="sale_advertising_order.group_ads_sales_manager"/>-->

<!--					<button name="action_refuse" string="Refuse"-->
<!--                            type="object" states="submitted"-->
<!--							groups="sale_advertising_order.group_ads_sales_manager"/>-->

<!--                    <button name="action_quotation_send" string="Send by Email" type="object" states="draft,approved1,sent,sale,done"-->
<!--                            class="btn-primary"	groups="sale_advertising_order.group_ads_sales_user"/>-->

<!--                    <button name="action_confirm" string="Confirm Sale" states="approved1,sent"-->
<!--                            class="btn-primary o_sale_confirm"-->
<!--                            groups="sale_advertising_order.group_ads_traffic_user" type="object" />-->

<!--                    <button name="action_cancel"  id="cancel" type="object" string="Cancel"-->
<!--                                  states="draft,sent"-->
<!--                                  groups="sale_advertising_order.group_ads_sales_user"/>-->
<!--                    <button name="action_cancel" id="cancel1" type="object" string="Cancel"-->
<!--                                  states="submitted,approved1"-->
<!--                                  groups="sale_advertising_order.group_ads_sales_manager"/>-->
<!--                    <button name="action_cancel" id="cancel2" type="object" string="Cancel"-->
<!--                             states="sale"-->
<!--                             groups="sale_advertising_order.group_ads_traffic_user"/>-->

<!--                    <button name="action_draft" states="cancel" type="object" string="Set to Quotation"/>-->
<!--                    <button name="action_done" type="object" string="Lock" states="sale" groups="sale_advertising_order.group_ads_traffic_user"/>-->
<!--                            help="If the sale is locked, you can not modify it anymore. However, you will still be able to invoice or deliver."/>-->
<!--                    <field name="state" widget="statusbar" statusbar_visible="draft,sent,submitted,approved1,sale,done"/>-->
<!--                </header>-->
<!--                <sheet>-->
<!--                    <div class="oe_button_box" name="button_box">-->
<!--                        <button name="action_view_invoice" groups="sale_advertising_order.group_ads_traffic_user"-->
<!--                            type="object"-->
<!--                            class="oe_stat_button"-->
<!--                            icon="fa-pencil-square-o"-->
<!--                            attrs="{'invisible': [('invoice_count', '=', 0)]}">-->
<!--                            <field name="invoice_count" widget="statinfo" string="Invoices"/>-->
<!--                        </button>-->
<!--                    </div>-->
<!--                    <div class="oe_title">-->
<!--                        <h1>-->
<!--                            <field name="name" readonly="1"/>-->
<!--                        </h1>-->
<!--                    </div>-->
<!--                    <notebook>-->
<!--                        <page string="Other Information">-->
<!--                            <group>-->
<!--                                <group string="Sales Information" name="sales_person0">-->
<!--                                    <field name="user_id"/>-->
<!--                                    <field name="team_id" options="{'no_create': True}"/>-->
<!--									<field name="tag_ids" widget="many2many_tags"/>-->
<!--                                    <field name="company_id" options="{'no_create': True}" groups="base.group_multi_company"/>-->
<!--                                    <field name="company_id" groups="!base.group_multi_company" invisible="1"/>-->

<!--                                </group>-->
<!--                                <group string="..." name="sales_person1">-->
<!--                                    <field name="type_id" required="1"/>-->
<!--&lt;!&ndash;                                    <field name="partner_acc_mgr"/>&ndash;&gt;-->
<!--&lt;!&ndash;                                    <field name="analytic_account_id"&ndash;&gt;-->
<!--&lt;!&ndash;                                           context="{'default_partner_id':partner_invoice_id, 'default_name':name}" groups="analytic.group_analytic_accounting"/>&ndash;&gt;-->
<!--&lt;!&ndash;                                     attrs="{'invisible':[('state','=','sale'),('published_customer','!=', False)]}" FIXME: Why this?&ndash;&gt;-->
<!--                                    <field name="nett_nett"/>-->

<!--                                </group>-->
<!--                                <group name="sale_pay" string="Invoicing">-->
<!--                                    <field name="fiscal_position_id" options="{'no_create': True}"/>-->
<!--                                    <field name="invoice_status"-->
<!--                                        attrs="{'invisible': [('state', 'not in', ('sale','done'))]}"/>-->
<!--                                    <field name="advertising" invisible="1"/>-->
<!--                                </group>-->
<!--                                <group string="Reporting" name="technical" >-->
<!--                                    <field name="origin"/>-->
<!--									<field name="campaign_id" />-->
<!--									<field name="medium_id" />-->
<!--									<field name="source_id" />-->
<!--									<field name="opportunity_id" help="Log in the chatter from which opportunity the order originates" />-->
<!--                                </group>-->
<!--								<group string="Shipping Information" name="sale_shipping" groups="base.group_no_one">-->
<!--								</group>-->

<!--                            </group>-->
<!--                        </page>-->
<!--                    </notebook>-->
<!--                </sheet>-->
<!--                <div class="oe_chatter">-->
<!--                    <field name="message_follower_ids" widget="mail_followers"/>-->
<!--                    <field name="message_ids" widget="mail_thread"/>-->
<!--                </div>-->
<!--                </form>-->
<!--            </field>-->
<!--        </record>-->


    <!--
        Orders
    -->
    <record id="action_orders_advertising" model="ir.actions.act_window">
        <field name="name">Sales Orders</field>
        <field name="res_model">sale.order</field>
        <field name="view_mode">tree,form,calendar,pivot,graph</field>
        <field name="view_id" ref="sale_order_view_form_sao"/>
<!--            <field name="search_view_id" ref="advertising_order_view_search_inherit_sale"/>-->
        <field name="domain"
               eval="[('type_id','=', ref('sale_advertising_order.ads_sale_type')), ('advertising','=',True), ('state','not in',('draft','sent','cancel'))]"
        />
        <field name="context"
            eval="{'default_advertising': 1, 'default_type_id': ref('sale_advertising_order.ads_sale_type')}"
        />
        <field name="help" type="html">
          <p class="oe_view_nocontent_create">
            Create a Quotation, the first step of a new sale.
          </p><p>
            Your next actions should flow efficiently: confirm the Quotation to an Advertising Order, then create the Invoice and collect the Payment.
          </p><p>
            Note that once a Quotation becomes a Order, it will be moved from the Quotations list to the Order list.
          </p>
        </field>
    </record>

    <record id="action_orders_advertising_form" model="ir.actions.act_window.view">
        <field eval="2" name="sequence"/>
        <field name="view_mode">form</field>
        <field name="view_id" ref="sale_order_view_form_sao"/>
        <field name="act_window_id" ref="action_orders_advertising"/>
    </record>

    <record id="action_orders_advertising_tree" model="ir.actions.act_window.view">
        <field eval="1" name="sequence"/>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="view_order_advertising_tree"/>
        <field name="act_window_id" ref="action_orders_advertising"/>
    </record>


    <!--
        Quotations
    -->
    <record id="action_quotations_advertising" model="ir.actions.act_window">
        <field name="name">Quotations </field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">sale.order</field>
        <field name="view_mode">tree,kanban,form,calendar,pivot,graph</field>
        <field name="view_id" ref="sale_order_view_form_sao"/>
<!--            <field name="search_view_id" ref="advertising_order_view_search_inherit_quotation"/>-->
        <field name="domain"
               eval="[('type_id','=', ref('sale_advertising_order.ads_sale_type')), ('advertising','=',True),('state','not in',('sale','done'))]"
        />
        <field name="context"
            eval="{'default_advertising': 1, 'default_type_id': ref('sale_advertising_order.ads_sale_type'), 'hide_sale': 1}"
        />
        <field name="help" type="html">
          <p class="oe_view_nocontent_create">
            Create a Quotation, the first step of a new sale.
          </p><p>
            Your next actions should flow efficiently: confirm the Quotation
            to an Advertising Order, then create the Invoice and collect the Payment.
          </p><p>
            Note that once a Quotation becomes an Order, it will be moved
            from the Quotations list to the Order list.
          </p>
        </field>
    </record>

    <record id="action_quotations_advertising_form" model="ir.actions.act_window.view">
        <field eval="2" name="sequence"/>
        <field name="view_mode">form</field>
        <field name="view_id" ref="sale_order_view_form_sao"/>
        <field name="act_window_id" ref="action_quotations_advertising"/>
    </record>

    <record id="action_quotations_advertising_tree" model="ir.actions.act_window.view">
        <field eval="1" name="sequence"/>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="view_order_advertising_tree"/>
        <field name="act_window_id" ref="action_quotations_advertising"/>
    </record>


    <!--
        Sale Order Lines / To Invoice (pivot)
    -->
    <record model="ir.ui.view" id="view_adv_order_line_pivot">
        <field name="name">sale.adv.order.line.pivot</field>
        <field name="model">sale.order.line</field>
        <field name="arch" type="xml">
            <pivot string="Advertising Order Lines" display_quantity="true">
                <field name="title"/>
                <field name="price_total" type="measure"/>
            </pivot>
        </field>
    </record>


    <!--
        Sale Order Lines / To Invoice (search)
    -->
    <record id="view_adv_order_line_filter" model="ir.ui.view">
        <field name="name">adv.sale.order.line.select</field>
        <field name="model">sale.order.line</field>
        <field name="arch" type="xml">
            <search string="Search Advertising Sales Order Lines">
                <filter string="To Invoice" name="to_invoice" domain="[('qty_to_invoice','&lt;&gt;', 0)]"  help="Sales Order Lines ready to be invoiced"/>
                <separator/>
                <filter name="my_sales_order_line" string="My Sales Order Lines" domain="[('salesman_id','=',uid)]" help="Sales Order Lines related to a Sales Order of mine"/>
                <filter name="accmgr_sale_orders_filter" string="My Sales Order Lines (Account Manager)"
                        domain="[('partner_acc_mgr','=',uid)]" help="My Sales Order Lines as Account manager" />
                <filter name="issue_date_sale_orders_filter" string="Order Lines with Issue Date before today"
                        domain="[('issue_date','&lt;=', datetime.datetime.now())]" help="Order Lines with Issue Date before today" />
                <filter name="from_date_sale_orders_filter" string="Order Lines with Start of Validity before today"
                        domain="[('from_date','&lt;=', datetime.datetime.now())]" help="Order Lines with Start of validity before today" />
                <field name="order_id"/>
                <field name="order_partner_id" operator="child_of"/>
                <field name="order_advertiser_id" operator="child_of"/>
                <field name="order_agency_id" operator="child_of"/>
                <field name="product_id"/>
                <field name="salesman_id"/>
                <field name="partner_acc_mgr"/>
                <field name="issue_date"/>
                <group expand="0" string="Group By">
                    <filter name="customer" string="Customer" domain="[]" context="{'group_by':'order_partner_id'}"/>
                    <filter name="advertiser" string="Advertiser" domain="[]" context="{'group_by':'order_advertiser_id'}"/>
                    <filter name="agency" string="Agency" domain="[]" context="{'group_by':'order_agency_id'}"/>
                    <filter name="product" string="Product" domain="[]" context="{'group_by':'product_id'}"/>
                    <filter name="order" string="Order" domain="[]" context="{'group_by':'order_id'}"/>
                    <filter name="salesperson" string="Salesperson" domain="[]" context="{'group_by':'salesman_id'}"/>
                    <filter name="acc_manager" string="Account Manager" icon="terp-personal" domain="[]" context="{'group_by':'partner_acc_mgr'}"/>
                    <filter name="issue_date" string="Issue Date" icon="terp-personal" domain="[]" context="{'group_by':'issue_date'}"/>
                    <filter name="adv_issue" string="Advertising Issue" domain="[]" context="{'group_by':'adv_issue'}"/>
                </group>
            </search>
        </field>
    </record>


    <!--
        Sale Order Lines / To Invoice (list)
    -->
    <record id="view_adv_order_line_tree" model="ir.ui.view">
        <field name="name">sale.adv.order.line.tree</field>
        <field name="model">sale.order.line</field>
        <field name="arch" type="xml">
            <tree string="Sales Order Lines" create="false">
                <field name="order_id" />
                <field name="id" />
                <field name="order_advertiser_id" />
                <field name="order_agency_id" />
                <field name="title" optional="hide"/>
                <field name="adv_issue" />
                <field name="issue_date" />
                <field name="from_date"/>
                <field name="to_date"/>
                <field name="ad_class" optional="hide"/>
                <field name="product_id" optional="hide"/>
                <field name="name" optional="hide"/>
                <field name="ad_number"/>
                <field name="product_uom" optional="hide"/>
                <field name="price_unit" optional="hide"/>
                <field name="product_uom_qty" optional="hide"/>
                <field name="actual_unit_price" optional="hide"/>
                <field name="computed_discount" optional="hide"/>
                <field name="subtotal_before_agency_disc" optional="hide"/>
<!--                <field name="discount_dummy" optional="hide"/>-->
                <field name="tax_id" optional="hide"/>
                <field name="price_subtotal" widget="monetary" groups="account.group_show_line_subtotals_tax_excluded"/>
                <field name="price_total" widget="monetary" groups="account.group_show_line_subtotals_tax_included"/>
                <field name="state" invisible="1"/>
                <field name="invoice_status" />
                <field name="currency_id" invisible="1"/>
            </tree>
        </field>
    </record>

     <!--
            Order Line (Adv /To Invoice)
    -->
    <record model="ir.ui.view" id="view_adv_order_line_form">
        <field name="name">sale.order.line.form.to.invoice</field>
        <field name="model">sale.order.line</field>
        <field name="arch" type="xml">
            <form string="Sales Order Lines" create="0" edit="0" delete="0">
                <header>
                    <field name="invoice_status" widget="statusbar" statusbar_visible="invoiced,to invoice,no"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="display_name" readonly="1"/>
                        </h1>
                    </div>
                    <group name="sale_header">
                        <group name="sh1">
                            <field name="order_partner_id" readonly="0" required="True"
                                   options="{'no_open': True,'no_create': True, 'no_create_edit': True}" />
                            <field name="order_advertiser_id" required="True"
                                   options="{'no_open': True,'no_create': True, 'no_create_edit': True}" />
                        </group>
                        <group name="sh2">
                            <field name="order_id" readonly="1" required="1"
                                   options="{'no_create': True, 'no_create_edit': True}"
                                   context="{'form_view_ref': 'sale_advertising_order.view_order_form_advertising'}"/>
                            <field name="order_pricelist_id" invisible="1"/>
                            <field name="company_id" invisible="1"/>
                        </group>
                    </group>
                    <group>
                        <group name="prod_section">
                            <field name="product_uom_category_id" invisible="1"/>
                            <field name="medium" required="True"
                                   domain="[('parent_id','=', %(sale_advertising_order.advertising_category)d)]"
                                   options="{'no_open': True,'no_create': True, 'no_create_edit': True}"/>
                            <field name="ad_class" required="True"
                                   domain="[('id','child_of', medium)]"
                                   options="{'no_open': True,'no_create': True, 'no_create_edit': True}"/>
                            <field name="title" string="Title" invisible="1"/>
                            <field name="title_ids" string="Title(s)"
                                   widget="many2many_tags"
                                   domain="[('parent_id','=', False), ('medium','child_of', medium)]"
                                   options="{'no_open': True,'no_create': True, 'no_create_edit': True}"
                                   context="{'active_test': False, 'search_view_ref':'sale_advertising_order.view_advertising_issue_filter',
                                             'tree_view_ref':'sale_advertising_order.advertising_issue_titles_tree' }">
                            </field>
                            <field name="from_date"
                                   attrs="{'invisible':[('date_type','!=','validity')], 'required':[('date_type','=','validity')]}"/>
                            <field name="to_date"
                                   attrs="{'invisible':[('date_type','!=','validity')], 'required':[('date_type','=','validity')]}"/>
                            <field name="deadline_offset" invisible="1"/>
                            <field name="deadline_passed" invisible="1" />
                            <field name="deadline" invisible="0" />
                             <field name="adv_issue_ids" string="Advertising Issue(s)"
                                   widget="many2many_tags"
                                   attrs="{'readonly': [('issue_product_ids','!=', [])]}"
                                   domain="[('parent_id','in', title_ids),
                                            '|','|',('deadline','&gt;=', deadline_offset),('deadline','=', False),
                                                    ('issue_date','&lt;=', datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S'))]"
                                   options="{'no_open': True,'no_create': True, 'no_create_edit': True}"
                                   context="{'active_test': False, 'search_view_ref':'sale_advertising_order.view_advertising_issue_filter',
                                             'tree_view_ref':'sale_advertising_order.advertising_issue_ids_tree' }">
                            </field>
                            <field name="issue_date" readonly="1" force_save="1"
                                   attrs="{'invisible': [('multi_line', '=', True)]}"/>
                            <field name="domain4prod_ids" invisible="1"/>
                            <field name="product_template_id" domain="[('id','in', domain4prod_ids)]"
                                   context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'uom':product_uom, 'company_id': parent.company_id}"
                                   attrs="{'readonly': ['|', ('qty_invoiced', '&gt;', 0), ('deadline_passed','=', True)]}"
                                   options="{'no_open': True,'no_create': True, 'no_create_edit': True}" required="1"/>
                            <field name="product_id" invisible="1" groups="base.group_no_one"
                                   context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'uom':product_uom, 'company_id': parent.company_id}"
                                   attrs="{'readonly': [('qty_invoiced', '&gt;', 0)]}"
                                   domain="['|','&amp;',('categ_id','=', ad_class),('product_template_attribute_value_ids','=', False),('product_tmpl_id','=', product_template_id)]"
                                   options="{'no_open': True,'no_create': True, 'no_create_edit': True}"/>
                            <field name="invoice_status" invisible="1"/>
                            <field name="qty_to_invoice" invisible="1"/>
                            <field name="nett_nett" />
                            <field name="multi_line" invisible="1"/>
                            <field name="multi_line_number" readonly="True" groups="base.group_no_one"/>
                            <field name="adv_issue" invisible="1"/>
                        </group>
                        <group name="price_section">
                            <label for="customer_lead" invisible="1" groups="base.group_no_one"/>
                            <div groups="base.group_no_one" invisible="1">
                                <field name="customer_lead" class="oe_inline" groups="base.group_no_one"/> days
                            </div>
                            <label for="product_uom_qty" string="Ordered Quantity"/>
                            <div>
                                <field name="product_uom_qty" class="oe_inline"
                                       context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id,
                                                    'uom':product_uom, 'uom_qty_change':True, 'company_id': parent.company_id}"
                                       attrs="{'readonly': [('deadline_passed','=', True)]}"/>
                                <field name="product_uom" invisible="1" groups="!uom.group_uom"/>
                                <field name="product_uom" groups="uom.group_uom" class="oe_inline oe_no_button"
                                       readonly="True"/>
                            </div>
                            <label for="qty_delivered" string="Delivered Quantity" invisible="1"/>
                            <div invisible="1">
                                <field name="qty_delivered"/>
                            </div>
                            <label for="qty_invoiced" string="Invoiced Quantity" invisible="1"/>
                            <div invisible="1">
                                <field name="qty_invoiced" invisible="context.get('hide_sale')"/>
                            </div>
                            <field name="tax_id" widget="many2many_tags"
                                domain="[('type_tax_use','=','sale'),('company_id','=',parent.company_id)]"
                                groups="sale_advertising_order.group_ads_traffic_user"
                                attrs="{'readonly': [('qty_invoiced', '&gt;', 0)]}"/>
                            <field name="price_edit" invisible="1"/>
                            <field name="price_unit" readonly="0" attrs="{'invisible': ['|',('multi_line','=', True),('price_edit','!=', True)]}"
                                    widget="monetary" options="{'currency_field': 'currency_id'}" />
                            <field name="price_unit_dummy" readonly="1" attrs="{'invisible': ['|',('multi_line','=', True),('price_edit','=', True)]}"
                                    widget="monetary" options="{'currency_field': 'currency_id'}" />
                            <field name="comb_list_price" readonly="True" attrs="{'invisible': [('multi_line','=', False)]}"
                                    widget="monetary" options="{'currency_field': 'currency_id'}" />
                            <field name="actual_unit_price" attrs="{'invisible': [('multi_line','=', True)]}" widget="monetary"
                                    options="{'currency_field': 'currency_id'}" />
                            <field name="computed_discount" invisible="1" groups="!product.group_discount_per_so_line"/>
                            <label for="computed_discount" groups="product.group_discount_per_so_line"/>
                                <div name="computed_discount" groups="product.group_discount_per_so_line">
                                    <field name="computed_discount" class="oe_inline"/> %%
                                </div>
                            <field name="discount_reason_id" attrs="{'invisible': [('computed_discount','=', 0.0)],'required': [('computed_discount','!=', 0.0)]}"/>
                            <field name="subtotal_before_agency_disc" readonly="False"/>
                            <label for="discount" string="Agency Commission" groups="product.group_discount_per_so_line"/>
                                <div name="discount" string="Agency Discount (%)" groups="product.group_discount_per_so_line">
                                    <field name="discount" invisible="1"/>
    <!--                                <field name="discount_dummy" class="oe_inline"/> %%-->
                                </div>
                            <field name="price_subtotal" readonly="True" widget="monetary"
                                    options="{'currency_field': 'currency_id'}" />
                            <field name="date_type" invisible="True"/>
                            <field name="currency_id" invisible="1"/>
                        </group>
                        </group>
                       <notebook>
                           <page string="Remarks">
                               <group>
                                   <group>
                                       <separator string="Description" colspan="2"/>
                                       <field name="name" colspan="2" nolabel="1"/>
                                       <separator string="Material Remarks" colspan="2"/>
                                       <field name="layout_remark" colspan="2" nolabel="1"/>
                                       <separator string="Migration Remarks" colspan="2"/>
                                       <field name="mig_remark" colspan="2" nolabel="1"/>
                                    </group>
                                   <group>
                                       <field name="page_class_domain" invisible="1"/>
                                       <label for="analytic_tag_ids" string="Page Category"/>
                                       <div>
                                            <field name="analytic_tag_ids"
                                                   string="Page Category"
                                                   widget="many2many_tags"
                                                   domain="page_class_domain"
                                                   attrs="{'readonly': [('deadline_passed','=', True)]}"/>
                                       </div>
                                        <field name="ad_number" attrs="{'invisible':[('multi_line','!=', False)]}"/>
                                        <field name="page_reference" attrs="{'invisible':[('multi_line','!=', False)]}"/>
                                        <field name="url_to_material" attrs="{'invisible':[('multi_line','!=', False)]}"/>
                                   </group>
                               </group>
                               <div groups="base.group_no_one">
                                   <label for="invoice_lines"/>
                                   <field name="invoice_lines"/>
                               </div>
                               <field name="state" invisible="1"/>
                           </page>
                           <page string="Proof Numbers">
                               <group>
                                   <group>
                                        <field name="proof_number_adv_customer" string="Proof Number Advertising Customer"
                                               domain="['|',('id', '=', parent.published_customer), ('parent_id', '=', parent.published_customer)]"
                                               context="{'default_parent_id': 'parent.partner_id', 'show_email': 1}" options="{'no_create_edit': True}" widget="many2many_tags"/>
                                        <field name="proof_number_payer" />
                                   </group>
                                   <group>
                                        <field name="proof_number_amt_adv_customer" attrs="{'invisible':[('proof_number_amt_adv_customer','=', 0)],'required':[('proof_number_adv_customer','!=', False)]}"/>
                                        <field name="proof_number_payer_id" domain="[('type', '=', 'contact'),('id','child_of',parent.partner_id)]" attrs="{'required': [('proof_number_amt_payer', '>', 0)]}" context="{'default_parent_id': 'order_partner_id', 'show_address': 1}" options="{'no_create_edit': True, 'always_reload': True}"/>
                                        <field name="proof_number_amt_payer" attrs="{'invisible':[('proof_number_payer_id','=', False)],'required':[('proof_number_payer_id','!=', False)]}"/>
                                   </group>
                               </group>
                           </page>
                           <page string="Adv.Issues with Products and Prices"
                                attrs="{'invisible':[('issue_product_ids','=',[])]}">
                                <field name="issue_product_ids" nolabel="1" string="Adv.Issues with Products and Prices"
                                       options="{'no_create': True, 'no_create_edit': True}" readonly="0">
                                    <tree string="Issues Products Prices" editable="bottom">
                                        <field name="adv_issue_id" string="Issue" force_save="1" domain="[('parent_id','in', parent.title_ids and parent.title_ids[0][2])]"/>
                                        <field name="product_attribute_value_id" force_save="1" invisible="True" />
                                        <field name="product_id" string="Product" force_save="1" domain="[('product_tmpl_id','=', parent.product_template_id), ('product_template_attribute_value_ids','in', product_attribute_value_id)]"/>
                                        <field name="price_unit" force_save="1" string="Unit Price"/>
                                        <field name="qty" force_save="1" string="Qty"/>
                                        <field name="price" force_save="1" string="Price"/>
                                        <field name="page_reference" string="Ref" />
                                        <field name="ad_number" string="Ad No." />
                                        <field name="url_to_material" string="URL Ad Material" />
                                    </tree>
                                </field>
                           </page>
                       </notebook>

                        <field name="state" invisible="1"/>
                    </sheet>
                </form>
            </field>
        </record>




    <!--
        Sale Order Lines / To Invoice
    -->
    <record model="ir.actions.act_window" id="all_advertising_order_lines_action">
        <field name="name">All Advertising Sale Order Lines</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">sale.order.line</field>
        <field name="view_mode">tree,form,pivot</field>
        <field name="view_id" ref="view_sao_order_line_form"/>
        <field name="search_view_id" ref="view_sao_order_line_filter"/>
        <field name="domain"
               eval="[('order_id.type_id','=', ref('sale_advertising_order.ads_sale_type')), ('advertising','=',True),('state','in',('sale','done'))]"
        />
        <field name="context">{'search_default_to_invoice': 1}</field>
    </record>

    <record id="all_advertising_order_lines_action_tree" model="ir.actions.act_window.view">
        <field eval="1" name="sequence"/>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="view_adv_order_line_tree"/>
        <field name="act_window_id" ref="all_advertising_order_lines_action"/>
    </record>

    <record id="all_advertising_order_lines_action_tree_view2" model="ir.actions.act_window.view">
        <field eval="2" name="sequence"/>
        <field name="view_mode">pivot</field>
        <field name="view_id" ref="view_adv_order_line_pivot"/>
        <field name="act_window_id" ref="all_advertising_order_lines_action"/>
    </record>

    <record id="all_advertising_order_lines_action_form_view" model="ir.actions.act_window.view">
        <field eval="3" name="sequence"/>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_adv_order_line_form"/>
        <field name="act_window_id" ref="all_advertising_order_lines_action"/>
    </record>


</data>
</odoo>